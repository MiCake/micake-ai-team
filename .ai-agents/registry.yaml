# =============================================================================
# AI Agent Framework - Unified Resource Registry
# =============================================================================
# Single entry point for all resources. LLM should read this file first for
# resource discovery.
# =============================================================================

version: "2.0"
last_updated: "2026-02-16T00:00:00Z"

# -----------------------------------------------------------------------------
# Resource Type Definitions
# -----------------------------------------------------------------------------
resource_types:
  agent:
    location: agents/
    pattern: "*.yaml"
    companion: "*.prompt.md"
    base_file: "_base.md"
    discoverable: true
    
  skill:
    location: skills/
    pattern: "*.md"
    has_frontmatter: true
    system_skills: "_system/"
    discoverable: true
    
  workflow:
    location: workflows/
    pattern: "*.yaml"
    discoverable: true
    
  knowledge:
    location: knowledge/
    index_file: manifest.yaml
    discoverable: true
    
  workspace:
    location: workspace/
    state_dir: state/
    context_dir: context/
    history_dir: history/
    discoverable: true

# -----------------------------------------------------------------------------
# Quick Index (LLM preferred reading)
# -----------------------------------------------------------------------------
quick_index:
  # Agent Index
  agents:
    - id: conductor
      file: agents/conductor.yaml
      prompt: agents/conductor.prompt.md
      description: Workflow coordinator and task dispatcher
      entry_commands: ["#start", "#init", "#status", "#pattern", "#recover"]
      
    - id: analyst
      file: agents/analyst.yaml
      prompt: agents/analyst.prompt.md
      description: Requirements analysis and concept extraction
      entry_commands: ["#analyze", "#extract", "#clarify"]
      
    - id: architect
      file: agents/architect.yaml
      prompt: agents/architect.prompt.md
      description: System architecture and technical design
      entry_commands: ["#design", "#plan"]
      
    - id: developer
      file: agents/developer.yaml
      prompt: agents/developer.prompt.md
      description: Code implementation specialist
      entry_commands: ["#implement", "#fix", "#refactor", "#frontend-doc"]
      
    - id: reviewer
      file: agents/reviewer.yaml
      prompt: agents/reviewer.prompt.md
      description: Review code quality and standards compliance
      entry_commands: ["#review", "#check"]
      
    - id: tester
      file: agents/tester.yaml
      prompt: agents/tester.prompt.md
      description: Test design and quality assurance
      entry_commands: ["#test"]

  # Skill Index
  skills:
    core:
      - id: project-initialization
        file: skills/project-initialization.md
        agents: [conductor]
        trigger: "#init"
        
      - id: review-execution
        file: skills/review-execution.md
        agents: [reviewer]
        trigger: "#review"
        
      - id: test-generation
        file: skills/test-generation.md
        agents: [tester]
        trigger: "#test"
        
      - id: frontend-doc-generation
        file: skills/frontend-doc-generation.md
        agents: [developer]
        trigger: "#frontend-doc"
        
    system:
      - id: context-loader
        file: skills/_system/context-loader.md
        auto_invoke: on_activation
        
      - id: archive-manager
        file: skills/_system/archive-manager.md
        triggers: [on_session_end, on_change_complete]

  # Workflow Index
  workflows:
    - id: requirement-to-code
      file: workflows/requirement-to-code.yaml
      phases: [analyze, design, implement, review, test]
      description: Complete development cycle from requirements to code
      
    - id: code-review
      file: workflows/code-review.yaml
      phases: [analyze, review, report]
      description: Code quality review workflow

  # Knowledge Pack Index
  knowledge_packs:
    - id: core
      path: knowledge/core/
      always_load: true
      priority: 1
      files: [software-principles.md]
      summary: Universal software engineering principles
      
    - id: ddd
      path: knowledge/patterns/ddd/
      conditional: "pattern.active == 'ddd'"
      priority: 2
      files: [overview.md, tactical-patterns.md, review-checklist.md]
      summary: Domain-Driven Design tactical and strategic patterns
      
    - id: clean-architecture
      path: knowledge/patterns/clean-architecture/
      conditional: "pattern.active == 'clean-architecture'"
      priority: 2
      files: [overview.md, review-checklist.md]
      summary: Clean Architecture dependency inversion and layer separation
      
    - id: principle
      path: knowledge/principle/
      always_load: false
      priority: 3
      generated: true
      summary: Project-specific coding standards and conventions
      
    - id: project
      path: knowledge/project/
      always_load: false
      priority: 4
      summary: Custom project knowledge

# -----------------------------------------------------------------------------
# Context Dependency Graph
# -----------------------------------------------------------------------------
context_graph:
  conductor:
    requires:
      - knowledge/core/
      - workspace/state/session.yaml
      - workspace/context/project.yaml
    outputs:
      - workspace/state/session.yaml
      
  analyst:
    requires:
      - knowledge/core/
      - workspace/requirements/
    outputs:
      - workspace/context/requirements.yaml
      - workspace/artifacts/{change-id}/analysis.md
      
  architect:
    requires:
      - knowledge/core/
      - knowledge/patterns/{active}/
      - workspace/context/requirements.yaml
    outputs:
      - workspace/context/architecture.yaml
      - workspace/artifacts/{change-id}/design.md
      
  developer:
    requires:
      - knowledge/core/
      - knowledge/patterns/{active}/
      - knowledge/principle/
      - workspace/context/architecture.yaml
    outputs:
      - workspace/artifacts/{change-id}/implementation/
      - workspace/artifacts/{change-id}/frontend-api-doc.md
      
  reviewer:
    requires:
      - knowledge/core/
      - knowledge/patterns/{active}/
      - knowledge/principle/
      - workspace/context/architecture.yaml
    outputs:
      - workspace/artifacts/{change-id}/review.md
      
  tester:
    requires:
      - knowledge/core/
      - workspace/context/requirements.yaml
    outputs:
      - workspace/artifacts/{change-id}/tests/

# -----------------------------------------------------------------------------
# Resource Discovery Protocol
# -----------------------------------------------------------------------------
discovery_protocol:
  steps:
    - step: 1
      name: "Check quick index"
      action: "Read registry.yaml → quick_index"
      
    - step: 2
      name: "Check resource type definitions"
      action: "Read registry.yaml → resource_types[{type}]"
      
    - step: 3
      name: "Check directory manifest"
      action: "Read manifest.yaml or _index.yaml in target directory"
      
    - step: 4
      name: "Fallback discovery"
      action: "List directory contents, infer structure from naming conventions"
